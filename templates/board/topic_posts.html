{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ topic.subject }}{% endblock %}

{% block content %}
<div class="container my-4">

  <!-- ðŸ§­ Breadcrumb navigation -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb bg-body-tertiary p-3 rounded shadow-sm">
      <li class="breadcrumb-item">
        <a href="{% url 'home' %}" class="text-decoration-none">Boards</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'board_topics:topics_in_board' topic.board.slug %}" class="text-decoration-none">
          {{ topic.board.name }}
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">{{ topic.subject }}</li>
    </ol>
  </nav>

  <!-- ðŸ§¾ Topic Header Card -->
  <div class="card shadow-sm mb-4 border-0">
    <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <h3 class="card-title mb-1">{{ topic.subject }}</h3>
        <p class="text-muted mb-0">
          Started by <strong>{{ topic.starter.username }}</strong> â€¢ {{ topic.created_at|naturaltime }}
        </p>
      </div>
      <div class="mt-3 mt-sm-0">
        <a href="{% url 'board_topics:reply_topic' topic.board.slug topic.topic_slug %}"
           class="btn btn-primary rounded-pill px-4">
          <i class="bi bi-reply-fill me-1"></i> Reply
        </a>
      </div>
    </div>
  </div>

  <!-- ðŸ’¬ Posts Section -->
  {% for post in topic.posts.all %}
    <div class="card mb-3 shadow-sm border-0">
      <div class="card-body p-4">
        <div class="d-flex align-items-start">
          <!-- ðŸ‘¤ User Info -->
          <div class="me-3 text-center" style="width: 90px;">
            <img src="{% static 'image/boy.png' %}" alt="{{ post.created_by.username }}"
                 class="rounded-circle border" width="70" height="70">
            <p class="small text-muted mt-2 mb-0">
              {{ post.created_by.username }}
            </p>
            <small class="text-muted d-block">Posts: {{ post.created_by.posts.count }}</small>
          </div>

          <!-- ðŸ’­ Message Content -->
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="fw-semibold">{{ post.created_by.username }}</span>
              <small class="text-muted">{{ post.created_at|naturaltime }}</small>
            </div>
            <p class="mb-0">{{ post.message|linebreaks }}</p>

            {% if post.created_by == user %}
              <div class="text-end mt-3">
                <a href="#" class="btn btn-outline-secondary btn-sm rounded-pill">
                  <i class="bi bi-pencil-square me-1"></i> Edit
                </a>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="alert alert-light text-center border shadow-sm">
      No posts yet. Be the first to 
      <a href="{% url 'board_topics:reply_topic' topic.board.slug topic.topic_slug %}">reply</a>!
    </div>
  {% endfor %}
</div>
{% endblock %}
